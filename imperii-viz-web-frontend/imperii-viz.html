<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8"> </meta>
            <style type="text/css">
                html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
            </style>
                
                <title>Imperii-Viz</title>

                <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
                <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
                <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
                <link href='http://fonts.googleapis.com/css?family=Lobster+Two:400,400italic,700italic' rel='stylesheet' type='text/css'>
                
                <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
                <link rel="stylesheet" type="text/css" href="assets/style.css">
                
                <script type="text/javascript"
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAi1TNweOF5G6B8S7ssmXzQxOI2oUQ50tQ">
                </script>
                
                <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyAi1TNweOF5G6B8S7ssmXzQxOI2oUQ50tQ"></script>
                
                <script type="text/javascript"
                src="https://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=true_or_false">
                </script>
                <script src="assets/jquery.js"></script>
                <script type="text/javascript">
                
                function initialize() {
                	
                	var mapOptions = {
                		center: { lat: 49, lng: 10},
                		zoom: 3};
                

                
                	var heatMapData = [];
                
                	var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
                
                
                	$.extend({
  					getUrlVars: function(){
    					var vars = [], hash;
    					var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    					for(var i = 0; i < hashes.length; i++)
    					{	
      						hash = hashes[i].split('=');
      						vars.push(hash[0]);
      						vars[hash[0]] = hash[1];
    					}
    					return vars;
  					},
  					getUrlVar: function(name){
    						return $.getUrlVars()[name];
  					}	
					});
					
					var personID = $.getUrlVar('personid');
                	console.log(personID);
                	
                	if(personID!=null) {
                		$.get( "http://imperii-viz.de:80/person/"+personID+"/regesten/", function( data ) {
                
                		var length = data.length;
                
                    	for(i = 0; i < length; i++) {
                    		if(data[i].place_of_issue!=null) {
                    			console.log(i +' '+ data[i].place_of_issue.latitude);
                    			heatMapData[i] = {location: new google.maps.LatLng(data[i].place_of_issue.latitude, data[i].place_of_issue.longitude), weight: 1};
                    		}
                   	 	}
                    
                    
                    
                
                    var heatmap = new google.maps.visualization.HeatmapLayer({ data: heatMapData }); 
                    heatmap.setOptions({radius:40});
                    
                    
                    
                    heatmap.setMap(map);
                    
   
                    
                    var link = document.getElementById('loadingScreen');
					link.style.display = 'none';
                    

                	});
                }
                
                
                
                
                $.get( "https://nameless-shelf-8882.herokuapp.com/hotel/get", function( data ) {
                
                
                	//setMarkers(map, data);
                });
                
                
                
                
                
                
                
                
                
                
                
                }
                
                
                
                function setMarkers(map, locations) {
                
                var image = {
                url: 'images/hotel.png',
                // This marker is 20 pixels wide by 32 pixels tall.
                size: new google.maps.Size(16, 16),
                // The origin for this image is 0,0.
                origin: new google.maps.Point(0,0),
                // The anchor for this image is the base of the flagpole at 0,32.
                anchor: new google.maps.Point(8, 8)
                };
                
                
                var hotelMarkers = [];
                
                
                for (var i = 0; i < locations.length; i++) {
                var hotel = locations[i];
                var myLatLng = new google.maps.LatLng(hotel.latitude, hotel.longitude);
                
                
                
                var marker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                id: hotel.id,
                icon: image,
                title: hotel.name,
                price: hotel.min_daily_rate,
                phonenumber: hotel.phone_number,
                url: hotel.url
                });
                
                
                
                google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent('<div style="text-align: center; width: 300px"><h1>'+this.title+'</h1>'+
                'San Francisco, CA 94133, US<br>' +
                'âœ† ' + this.phonenumber +'<br>' +
                '<br>Price: <b>'+ this.price + '$</b> per night' +
                
                '<br><a href="'+this.url+'" target="_blank">Make Reservation</a><br>'+

                '<a href="http://www.expedia.com/Flights" target="_blank">Book Flight</a><br>'+
                '<br><button type="button" id="modal-button" class="btn btn-info" data-toggle="modal" data-target="#modal-box">Safety Statistics</button><br></div>')
                infowindow.open(map,this);
                });
                
                
                
                
                }
                }

                
                
                var infowindow = new google.maps.InfoWindow({
                
                });
                
                
                
                
                
                google.maps.event.addDomListener(window, 'load', initialize);
                </script>
                </head>
    <body>
        <div class="container">
            <div id="page-descr">
                <div id="sf">Imperii-Viz
                
                </div>
            </div>
            <div id="map-canvas"></div>

            <!-- Modal -->
              <div class="modal fade" id="modal-box" role="dialog">
                <div class="modal-dialog">
                
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h3 class="modal-title">Area Safety Statistics</h3>
                    </div>
                    <div class="modal-body">
                      <h4>Most recent crime: <bold>Theft</bold></h4> 
                      <h4>Most common crime: <bold>Simple Assult</bold></h4> 

                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                  
                </div>
              </div>
        </div>
        
        <div id="loadingScreen">
        	<center><img src="./images/loading.gif" id='loadingindicator'></center>
        </div>
        
    </body>
</html>